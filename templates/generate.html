<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>블로그 생성 - 법률 블로그 시스템</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .generate-container {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: #333;
            padding: 40px 0;
        }
        .style-card {
            transition: transform 0.2s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .style-card:hover {
            transform: translateY(-3px);
        }
        .style-card.selected {
            border-color: #007bff;
            background-color: #f8f9fa;
        }
        .blog-preview {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        .loading {
            display: none;
        }
        .source-item {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- 네비게이션 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-gavel me-2"></i>법률 블로그 시스템
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/crawl">크롤링</a>
                <a class="nav-link" href="/search">검색</a>
                <a class="nav-link active" href="/generate">블로그 생성</a>
            </div>
        </div>
    </nav>

    <!-- 생성 섹션 -->
    <section class="generate-container">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <h2 class="text-center mb-4">
                        <i class="fas fa-magic me-3"></i>AI 블로그 포스팅 생성
                    </h2>
                    <p class="text-center mb-4">검색된 법률 정보를 바탕으로 전문적인 블로그 포스팅을 자동 생성합니다.</p>
                    
                    <form id="generateForm">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="topic" class="form-label">주제</label>
                                    <input type="text" id="topic" class="form-control" 
                                           placeholder="블로그 포스팅 주제를 입력하세요 (예: 채권추심 방법, 지급명령 신청 절차)" 
                                           required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="sourcesCount" class="form-label">참고 자료 수</label>
                                    <select id="sourcesCount" class="form-select">
                                        <option value="3">3개</option>
                                        <option value="5" selected>5개</option>
                                        <option value="10">10개</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 스타일 선택 -->
                        <div class="mb-4">
                            <label class="form-label">글 스타일</label>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card style-card" data-style="professional">
                                        <div class="card-body text-center">
                                            <i class="fas fa-user-tie fa-2x text-primary mb-2"></i>
                                            <h6>전문가형</h6>
                                            <small class="text-muted">정확하고 전문적인 톤</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card style-card" data-style="casual">
                                        <div class="card-body text-center">
                                            <i class="fas fa-smile fa-2x text-success mb-2"></i>
                                            <h6>친근한형</h6>
                                            <small class="text-muted">쉽고 친근한 톤</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card style-card" data-style="detailed">
                                        <div class="card-body text-center">
                                            <i class="fas fa-list-alt fa-2x text-warning mb-2"></i>
                                            <h6>상세형</h6>
                                            <small class="text-muted">자세하고 포괄적인 내용</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-magic me-2"></i>블로그 포스팅 생성
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- 결과 섹션 -->
    <section class="py-5">
        <div class="container">
            <!-- 로딩 -->
            <div id="loading" class="loading text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">생성 중...</span>
                </div>
                <p class="mt-2">블로그 포스팅을 생성하고 있습니다...</p>
            </div>

            <!-- 결과 -->
            <div id="resultSection" style="display: none;">
                <div class="row">
                    <div class="col-md-8">
                        <div class="blog-preview">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h4>생성된 블로그 포스팅</h4>
                                <div>
                                    <button class="btn btn-outline-primary btn-sm" onclick="copyToClipboard()">
                                        <i class="fas fa-copy me-1"></i>복사
                                    </button>
                                    <button class="btn btn-outline-success btn-sm" onclick="downloadBlog()">
                                        <i class="fas fa-download me-1"></i>다운로드
                                    </button>
                                </div>
                            </div>
                            <div id="blogContent" class="blog-content"></div>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <!-- 생성 정보 -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5><i class="fas fa-info-circle me-2"></i>생성 정보</h5>
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h6 class="text-muted">주제</h6>
                                        <span id="generatedTopic" class="fw-bold">-</span>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-muted">스타일</h6>
                                        <span id="generatedStyle" class="fw-bold">-</span>
                                    </div>
                                </div>
                                <hr>
                                <div class="row text-center">
                                    <div class="col-6">
                                        <h6 class="text-muted">참고 자료</h6>
                                        <span id="sourcesUsed" class="fw-bold text-primary">-</span>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-muted">생성 시간</h6>
                                        <span id="generateTime" class="fw-bold text-success">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 참고 자료 -->
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-book me-2"></i>참고 자료</h5>
                            </div>
                            <div class="card-body">
                                <div id="sourcesList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 빈 상태 -->
            <div id="emptyState" class="text-center py-5">
                <i class="fas fa-edit fa-3x text-muted mb-3"></i>
                <h4 class="text-muted">블로그 포스팅을 생성해보세요</h4>
                <p class="text-muted">주제와 스타일을 선택하고 생성 버튼을 클릭하세요.</p>
            </div>
        </div>
    </section>

    <!-- 푸터 -->
    <footer class="bg-dark text-white py-4">
        <div class="container text-center">
            <p>&copy; 2025 법률 블로그 검색 & 생성 시스템. All rights reserved.</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let selectedStyle = 'professional';
        let currentBlogContent = '';

        // 스타일 선택
        document.querySelectorAll('.style-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.style-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                selectedStyle = this.dataset.style;
            });
        });

        // 기본 스타일 선택
        document.querySelector('[data-style="professional"]').classList.add('selected');

        // 폼 제출
        document.getElementById('generateForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const topic = document.getElementById('topic').value.trim();
            if (!topic) return;
            
            await generateBlog(topic);
        });

        // 블로그 생성
        async function generateBlog(topic) {
            const startTime = Date.now();
            
            // UI 업데이트
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('emptyState').style.display = 'none';
            
            try {
                const formData = new FormData();
                formData.append('topic', topic);
                formData.append('style', selectedStyle);
                formData.append('search_results_count', document.getElementById('sourcesCount').value);
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                const generateTime = Date.now() - startTime;
                
                if (result.success) {
                    displayBlog(result, generateTime);
                } else {
                    displayError(result.error);
                }
            } catch (error) {
                displayError('생성 중 오류가 발생했습니다: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // 블로그 표시
        function displayBlog(result, generateTime) {
            currentBlogContent = result.blog_post;
            
            // 블로그 내용 표시
            document.getElementById('blogContent').innerHTML = 
                '<pre style="white-space: pre-wrap; font-family: inherit;">' + 
                result.blog_post + 
                '</pre>';
            
            // 정보 업데이트
            document.getElementById('generatedTopic').textContent = result.topic;
            document.getElementById('generatedStyle').textContent = getStyleName(result.style);
            document.getElementById('sourcesUsed').textContent = result.sources_used + '개';
            document.getElementById('generateTime').textContent = generateTime + 'ms';
            
            // 참고 자료 표시 (실제로는 검색 결과를 표시해야 함)
            document.getElementById('sourcesList').innerHTML = `
                <div class="source-item">
                    <small class="text-muted">검색된 ${result.sources_used}개의 관련 문서를 참고하여 생성되었습니다.</small>
                </div>
            `;
            
            // 결과 섹션 표시
            document.getElementById('resultSection').style.display = 'block';
        }

        // 오류 표시
        function displayError(error) {
            document.getElementById('resultSection').innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    ${error}
                </div>
            `;
            document.getElementById('resultSection').style.display = 'block';
        }

        // 스타일 이름 변환
        function getStyleName(style) {
            const names = {
                'professional': '전문가형',
                'casual': '친근한형',
                'detailed': '상세형'
            };
            return names[style] || style;
        }

        // 클립보드 복사
        function copyToClipboard() {
            navigator.clipboard.writeText(currentBlogContent).then(() => {
                alert('클립보드에 복사되었습니다!');
            }).catch(err => {
                console.error('복사 실패:', err);
            });
        }

        // 다운로드
        function downloadBlog() {
            const blob = new Blob([currentBlogContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `blog_post_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>














